#!/usr/bin/with-contenv bash

# 设置默认值
PUID=${PUID:-1000}
PGID=${PGID:-1000}

echo "[init] 开始用户映射配置 PUID=$PUID, PGID=$PGID"

# 获取当前用户和组的ID
CURRENT_UID=$(id -u bonita)
CURRENT_GID=$(id -g bonita)

# 如果需要修改用户ID
if [ "$PUID" != "$CURRENT_UID" ]; then
    echo "[init] 修改用户ID从 $CURRENT_UID 到 $PUID"
    usermod -u "$PUID" bonita
fi

# 如果需要修改组ID
if [ "$PGID" != "$CURRENT_GID" ]; then
    echo "[init] 修改组ID从 $CURRENT_GID 到 $PGID"
    groupmod -g "$PGID" bonita
fi

# 确保应用目录权限正确
echo "[init] 设置目录权限"
chown -R bonita:bonita /app /var/log/nginx /var/lib/nginx /var/run

echo "[init] 用户映射配置完成" 